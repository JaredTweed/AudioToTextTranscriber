# io.github.jtweed.AudioToTextTranscriber.yml
id:       io.github.jtweed.AudioToTextTranscriber
runtime:  org.gnome.Platform
runtime-version: '48'        # ← GNOME 48 runtime on Flathub
sdk:      org.gnome.Sdk
command:  audio-to-text-transcriber

finish-args:
  - --socket=wayland
  - --socket=x11
  - --device=dri
  - --share=network
  - --filesystem=home

modules:
  # 1 ▸ Build whisper.cpp once, inside the SDK 48 sandbox
  - name: whisper-cpp
    buildsystem: cmake
    cmake-args:
      - -DWHISPER_CUBLAS=OFF      # strip optional back-ends you don’t use
      - -DBUILD_TESTS=OFF
      - -DBUILD_SHARED_LIBS=OFF
    sources:
      - type: git
        url: https://github.com/ggerganov/whisper.cpp.git
        tag: v1.7.5               # latest release as of Apr 2025 :contentReference[oaicite:0]{index=0}

  # 2 ▸ Copy Python sources and launcher
  - name: app
    buildsystem: simple
    build-commands:
      - install -Dm755 ../whisper-cpp/build/bin/whisper-cli -t /app/bin
      - install -Dm644 -t /app/share/audio-to-text-transcriber src/*.py
      - install -Dm644 -t /app/share/audio-to-text-transcriber/models \
          src/models/download-ggml-model.sh
      - install -Dm755 wrapper.sh /app/bin/audio-to-text-transcriber
    sources:
      - type: dir
        path: src
      - type: file
        path: wrapper.sh
